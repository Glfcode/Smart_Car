C51 COMPILER V9.53.0.0   12864                                                             05/24/2015 10:41:28 PAGE 1   


C51 COMPILER V9.53.0.0, COMPILATION OF MODULE 12864
OBJECT MODULE PLACED IN ..\Output\12864.obj
COMPILER INVOKED BY: D:\Keil_MDK\C51\BIN\C51.EXE ..\FWlib\12864.c OPTIMIZE(8,SPEED) BROWSE INCDIR(..\FWlib;..\User) DEBU
                    -G OBJECTEXTEND PRINT(..\Listing\12864.lst) TABS(2) OBJECT(..\Output\12864.obj)

line level    source

   1          /********************电赛阶段 ********************
   2           * 文件名  ：12864.c
   3           * 描述    ：定义的类型        
   4           * 作者    ：晓峰 
   5           * 硬件连接： -------------------------------
   6           *           |   |
   7           *           |   |
   8           *           |   |
   9           *           |   |
  10           *           |   |
  11           *            -------------------------------
  12           * 时间    ：2013年5月24 
  13          ***************************************************/
  14          #include "config.h"
  15          
  16          /*****************************************************************************
  17                              引脚定义  （板子不可变的）
  18          /****************************************************************************/
  19          #define   LCD12864_DB0_DB7    P0        // 定义LCD1602的数据总线
  20          sbit LCD12864_RS   = P2 ^ 3;      // 定义LCD1602的RS控制线
  21          sbit LCD12864_RW   = P2 ^ 4;          // 定义LCD1602的RW控制线
  22          sbit LCD12864_E    = P2 ^ 5;          // 定义LCD1602的E控制线
  23          sbit PSB = P2^6;
  24          /*****************************************************************************
  25          定义LCD12864指令集 （详细请见查看12864指令集手册）
  26          /****************************************************************************/
  27          #define     CMD_clear   0x01             // 清除屏幕
  28          #define     CMD_back    0x02             // DDRAM回零位
  29          #define     CMD_base    0x30          // 基础指令集
  30          #define     CMD_expand    0x36         // 扩展指令集
  31          #define     CMD_display   0x0c             // 开显示_关光标_关光标闪烁
  32          #define     CMD_set     0x38             // 8位总线_2行显示
  33          #define     line_one    0x80             // 第一行写入地址
  34          #define     line_two    0x90             // 第二行写入地址
  35          #define     line_three    0x88             // 第三行写入地址
  36          #define     line_four   0x98             // 第四行写入地址
  37          /*****************************************************************************
  38          函数名DELAY_MS ()
  39          参数： unsigned int a
  40          返回值：无
  41          备注：毫秒级延迟函数
  42          /****************************************************************************/
  43          
  44          void DELAY_MS (unsigned int a)
  45          {
  46   1        unsigned int i;
  47   1        while( a-- != 0)
  48   1        {
  49   2          for(i = 0; i < 600; i++);
  50   2        }
  51   1      }
  52          /*****************************************************************************
  53          函数名：LCD12864_TestBusy（）
  54          参数： 无
C51 COMPILER V9.53.0.0   12864                                                             05/24/2015 10:41:28 PAGE 2   

  55          返回值：无
  56          备注：LCD12864测忙，若LCD12864处于忙状态，本函数将等待至非忙状态
  57          ****************************************************************************/
  58          void LCD12864_TestBusy(void)
  59          {
  60   1        LCD12864_DB0_DB7=0xff;
  61   1        LCD12864_RS=0;
  62   1        LCD12864_RW=1;
  63   1        LCD12864_E=1;
  64   1          while(LCD12864_DB0_DB7&0x80);
  65   1        LCD12864_E=0;
  66   1      }
  67          
  68          /*****************************************************************************
  69          函数名：LCD12864_TestBusy（）
  70          参数： unsigned char LCD12864_command
  71          返回值：无
  72          备注：写指令
  73          ****************************************************************************/
  74          
  75          void LCD12864_WriteCMD(unsigned char LCD12864_command)
  76          {
  77   1        LCD12864_TestBusy();
  78   1        LCD12864_RS=0;
  79   1        LCD12864_RW=0;
  80   1        LCD12864_E=1;
  81   1        LCD12864_DB0_DB7=LCD12864_command;
  82   1        LCD12864_E=0;
  83   1      } 
  84                  
  85          /*****************************************************************************
  86          函数名LCD12864_WriteData()
  87          参数： unsigned char LCD12864_command
  88          返回值：无
  89          备注：  向LCD12864写数据
  90          
  91          /****************************************************************************/
  92          void LCD12864_WriteData(unsigned char LCD12864_data)
  93          {
  94   1        LCD12864_TestBusy();
  95   1        LCD12864_RS=1;
  96   1        LCD12864_RW=0;
  97   1        LCD12864_E=1;
  98   1        LCD12864_DB0_DB7=LCD12864_data;
  99   1        LCD12864_E=0;
 100   1      }
 101          
 102          /*****************************************************************************
 103          函数名pprint()
 104          参数： unsigned char x,unsigned char y,unsigned char *str
 105          返回值：无
 106          备注：  打印字符串程序（本函数调用指针函数）向LCD发送一个字符串,长度64字符之内 
 107          /****************************************************************************/
 108          void print(unsigned char x,unsigned char y,unsigned char *str)
 109          {
 110   1        LCD12864_WriteCMD(x+y);
 111   1        while(*str!='\0')
 112   1        {         
 113   2            LCD12864_WriteData(*str++); 
 114   2        }
 115   1        *str=0;
 116   1      }
C51 COMPILER V9.53.0.0   12864                                                             05/24/2015 10:41:28 PAGE 3   

 117          
 118          /*****************************************************************************
 119          函数名LCD12864_Init()
 120          参数： 无
 121          返回值：无
 122          备注：LCD12864初始化 
 123          /****************************************************************************/
 124          void LCD12864_Init(void)
 125          {
 126   1        PSB = 1; // 选择并口模式
 127   1        LCD12864_WriteCMD(CMD_base);        //初始化下面指令均为基础指令
 128   1        LCD12864_WriteCMD(CMD_back);        //  DDRAM回零位,光标移到开头原点位置
 129   1        LCD12864_WriteCMD(CMD_display);     //  开显示_关光标_关光标闪烁
 130   1        LCD12864_WriteCMD(CMD_clear);       //  清屏
 131   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    149    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----       3
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
